<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Stack | Bill's Blog]]></title>
  <link href="http://ibillxia.github.io/blog/tags/stack/atom.xml" rel="self"/>
  <link href="http://ibillxia.github.io/"/>
  <updated>2014-05-12T23:52:14+08:00</updated>
  <id>http://ibillxia.github.io/</id>
  <author>
    <name><![CDATA[Bill Xia]]></name>
    <email><![CDATA[ibillxia@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[06年浙大复试机试题解]]></title>
    <link href="http://ibillxia.github.io/blog/2012/03/02/06-zju-program-test-solution/"/>
    <updated>2012-03-02T12:12:00+08:00</updated>
    <id>http://ibillxia.github.io/blog/2012/03/02/06-zju-program-test-solution</id>
    <content type="html"><![CDATA[<p>
06年浙大研究生复试机试题解
</p>




<h3>A题：还是A+B（hdoj1229）（九度1015）</h3>


<p>水题，简直水得不能再水</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Problem A </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;stdio.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;string.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>int main()
</span><span class='line'>{&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>int a,b,k,t;
</span><span class='line'>while(1){
</span><span class='line'>    scanf("%d %d %d",&amp;a,&amp;b,&amp;k);
</span><span class='line'>    if(a==0&amp;&amp;b==0) return 0;
</span><span class='line'>    t=1;
</span><span class='line'>    while(k--)t*=10;
</span><span class='line'>    if(a%t==b%t)printf("%d\n",-1);
</span><span class='line'>    else printf("%d\n",a+b);
</span><span class='line'>}
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<!-- more -->


<h3>B题：火星A+B（hdoj1230）（九度1016）</h3>


<p>不是很难，注意判断输出的首位是否为零，如果为零，就不要输出（除非结果为0）。
虽然不难，但九度居然将其标为五星题，表示很费解。
代码如下：
</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Problem B </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>include&lt;stdio.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>int d[]={2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101};
</span><span class='line'>int main()
</span><span class='line'>{&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>int a[25],b[25],c[26],al,bl,t;
</span><span class='line'>while(1){
</span><span class='line'>    al=bl=0;
</span><span class='line'>    while(scanf("%d",a+al++)&amp;&amp;getchar()!=' ');
</span><span class='line'>    while(scanf("%d",b+bl++)&amp;&amp;getchar()==',');
</span><span class='line'>    if(a[0]==0&amp;&amp;b[0]==0)break;
</span><span class='line'>    t=0;c[0]=0;
</span><span class='line'>    while(al&gt;0&amp;&amp;bl&gt;0){
</span><span class='line'>        al--;bl--;
</span><span class='line'>        c[t+1]=(a[al]+b[bl]+c[t])/d[t];
</span><span class='line'>        c[t]=(a[al]+b[bl]+c[t])%d[t];
</span><span class='line'>        t++;
</span><span class='line'>    }
</span><span class='line'>    while(al&gt;0){
</span><span class='line'>        al--;
</span><span class='line'>        c[t+1]=(a[al]+c[t])/d[t];
</span><span class='line'>        c[t]=(a[al]+c[t])%d[t];
</span><span class='line'>        t++;
</span><span class='line'>    }
</span><span class='line'>    while(bl&gt;0){
</span><span class='line'>        bl--;
</span><span class='line'>        c[t+1]=(b[bl]+c[t])/d[t];
</span><span class='line'>        c[t]=(b[bl]+c[t])%d[t];
</span><span class='line'>        t++;
</span><span class='line'>    }
</span><span class='line'>    if(c[t]==0) t--;
</span><span class='line'>    while(t&gt;0)
</span><span class='line'>        printf("%d,",c[t--]);
</span><span class='line'>    printf("%d\n",c[0]);
</span><span class='line'>}
</span><span class='line'>return 0;
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>C题：还是畅通工程（hdoj1233）（九度1017）</h3>


<p>模板题，prim算法，代码如下：</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Problem C </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;stdio.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;memory.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>define INF 0x7fffffff&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>int n,d[100][100];
</span><span class='line'>int prim(){&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>int i,j,t,sum,min,vis[100],low[100];
</span><span class='line'>memset(vis,0,sizeof(vis));
</span><span class='line'>vis[0]=1;
</span><span class='line'>sum=0;
</span><span class='line'>low[0]=INF;
</span><span class='line'>for(i=1;i&lt;n;i++) low[i]=d[0][i];
</span><span class='line'>for(i=1;i&lt;n;i++){
</span><span class='line'>    t=-1;min=INF;
</span><span class='line'>    for(j=0;j&lt;n;j++)
</span><span class='line'>        if(!vis[j] &amp;&amp; min&gt;low[j]){
</span><span class='line'>            t=j;min=low[j];
</span><span class='line'>        }
</span><span class='line'>    vis[t]=1;
</span><span class='line'>    sum+=min;
</span><span class='line'>    for(j=0;j&lt;n;j++)
</span><span class='line'>        if(!vis[j] &amp;&amp; d[t][j]&lt;low[j]){
</span><span class='line'>            low[j] = d[t][j];
</span><span class='line'>        }
</span><span class='line'>}
</span><span class='line'>return sum;
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>}
</span><span class='line'>int main()
</span><span class='line'>{&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>int i,j,from,to,dis,min;
</span><span class='line'>while(1){
</span><span class='line'>    scanf("%d",&amp;n);
</span><span class='line'>    if(0==n)break;
</span><span class='line'>    for(i=0;i&lt;n;i++)d[i][i]=INF;
</span><span class='line'>    j=(n*(n-1))&gt;&gt;1;
</span><span class='line'>    for(i=0;i&lt;j;i++){
</span><span class='line'>        scanf("%d %d %d",&amp;from,&amp;to,&amp;dis);
</span><span class='line'>        d[from-1][to-1]=d[to-1][from-1]=dis;
</span><span class='line'>    }
</span><span class='line'>    min = prim();
</span><span class='line'>    printf("%d\n",min);
</span><span class='line'>}
</span><span class='line'>return 0;
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>D题：统计同成绩学生人数（hdoj1235）（九度1018）</h3>


<p>水题，同样很水，代码如下：</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Problem D </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;stdio.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>int n,d[1001],t,cnt;
</span><span class='line'>int main()
</span><span class='line'>{&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>int i;
</span><span class='line'>while(1){
</span><span class='line'>    scanf("%d",&amp;n);
</span><span class='line'>    if(0==n)break;
</span><span class='line'>    for(i=0;i&lt;n;i++)
</span><span class='line'>        scanf("%d",d+i);
</span><span class='line'>    scanf("%d",&amp;t);
</span><span class='line'>    cnt=0;
</span><span class='line'>    for(i=0;i&lt;n;i++)
</span><span class='line'>        if(d[i]==t)cnt++;
</span><span class='line'>    printf("%d\n",cnt);
</span><span class='line'>}
</span><span class='line'>return 0;
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>E题：简单计算器（hdoj1237）（九度1019）</h3>


<p>有一点难度，但如果对此比较有研究，就不难了。
主要思路是利用栈，得到表达式的逆波兰式，再进行计算，代码如下：</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Problem E </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;stdio.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;string.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>char in[202],cstk[80];
</span><span class='line'>int ct,dt;
</span><span class='line'>double dstk[80];
</span><span class='line'>int cmp(char c1,char c2){&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>int i,a[2];
</span><span class='line'>char c[2];
</span><span class='line'>c[0]=c1;
</span><span class='line'>c[1]=c2;
</span><span class='line'>for(i=0;i&lt;2;i++){
</span><span class='line'>    switch(c[i]){
</span><span class='line'>        case '+':
</span><span class='line'>        case '-':
</span><span class='line'>            a[i]=1;
</span><span class='line'>            break;
</span><span class='line'>        case '*':
</span><span class='line'>        case '/':
</span><span class='line'>            a[i]=2;
</span><span class='line'>            break;
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>return a[0]-a[1];
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>}
</span><span class='line'>double cal(double da,double db,char ch){&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>switch(ch){
</span><span class='line'>    case '+':return db+da;
</span><span class='line'>    case '-':return db-da;
</span><span class='line'>    case '*':return db*da;
</span><span class='line'>    case '/':return db/da;
</span><span class='line'>}
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>}
</span><span class='line'>int main()
</span><span class='line'>{&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>char c1,c2;
</span><span class='line'>int len,i,a;
</span><span class='line'>double da,db,dc;
</span><span class='line'>while(1){
</span><span class='line'>    gets(in);
</span><span class='line'>    len = strlen(in);
</span><span class='line'>    if(1==len &amp;&amp; in[0]=='0')break;
</span><span class='line'>    ct=dt=0;
</span><span class='line'>    for(i=0;i&lt;len;i++){
</span><span class='line'>        a=0;
</span><span class='line'>        while(in[i]&gt;='0'&amp;&amp;in[i]&lt;='9')
</span><span class='line'>            a=a*10+(in[i++]-'0');
</span><span class='line'>        dstk[dt++]=(double)a;
</span><span class='line'>        i++;
</span><span class='line'>        if(i&lt;len)cstk[ct++]=in[i];
</span><span class='line'>        i++;
</span><span class='line'>    }
</span><span class='line'>    for(i=0;i&lt;dt/2;i++){
</span><span class='line'>        da=dstk[i];
</span><span class='line'>        dstk[i]=dstk[dt-i-1];
</span><span class='line'>        dstk[dt-i-1]=da;
</span><span class='line'>    }
</span><span class='line'>    for(i=0;i&lt;ct/2;i++){
</span><span class='line'>        c1=cstk[i];
</span><span class='line'>        cstk[i]=cstk[ct-i-1];
</span><span class='line'>        cstk[ct-i-1]=c1;
</span><span class='line'>    }
</span><span class='line'>    while(ct){
</span><span class='line'>        da=dstk[--dt];
</span><span class='line'>        db=dstk[--dt];
</span><span class='line'>        c1=cstk[--ct];
</span><span class='line'>        if(ct&gt;0){
</span><span class='line'>            c2=cstk[ct-1];
</span><span class='line'>            if(cmp(c1,c2)&gt;=0){
</span><span class='line'>                dstk[dt++]=cal(db,da,c1);
</span><span class='line'>            }else{
</span><span class='line'>                dc=dstk[--dt];
</span><span class='line'>                c2=cstk[--ct];
</span><span class='line'>                dstk[dt++]=cal(dc,db,c2);
</span><span class='line'>                dstk[dt++]=da;
</span><span class='line'>                cstk[ct++]=c1;
</span><span class='line'>            }
</span><span class='line'>        }else{
</span><span class='line'>            dstk[dt++]=cal(db,da,c1);
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    printf("%.2f\n",dstk[0]);
</span><span class='line'>}
</span><span class='line'>return 0;
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>}</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>小结：总体而言不是很难，主要是水题很水，而难点的题也不是很难，稍微耐心、细心点，就能AC了。</p>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[浅谈C语言的可变参数]]></title>
    <link href="http://ibillxia.github.io/blog/2011/04/21/about-variable-parameters-in-c-language/"/>
    <updated>2011-04-21T16:50:00+08:00</updated>
    <id>http://ibillxia.github.io/blog/2011/04/21/about-variable-parameters-in-c-language</id>
    <content type="html"><![CDATA[<h2>1.问题引入</h2>


<p>
C语言中有些函数使用可变参数，比如常见的int printf( const char *format [, argument]... );，
第一个参数format是固定的，其余的参数的个数和类型都不固定。例如：</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>printf("Enjoy yourself everyday!/n");
</span><span class='line'>printf("The value is %d!/n", value);</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>这种可变参数可以说是C语言一个比较难理解的部分，这里会由几个问题引发一些对它的分析。
注意：在C++中有函数重载（overload）可以用来区别不同函数参数的调用，但它还是不能表示任意数量的函数参数。</p>




<h2>2.printf（）实现原理</h2>


<p>
C语言用va_start等宏来处理这些可变参数。这些宏看起来很复杂，其实原理挺简单，
就是根据参数入栈的特点从最靠近第一个可变参数的固定参数开始，依次获取每个可变参数的地址。
下面我们来分析这些宏。</p>




<!-- more -->


<p>在stdarg.h头文件中，针对不同平台有不同的宏定义，我们选取X86平台下的宏定义：</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>typedef char * va_list;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>define _INTSIZEOF(n) ( (sizeof(n) + sizeof(int) - 1) &amp; ~(sizeof(int) - 1) )&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>define va_start(ap,v) ( ap = (va_list)&amp;v + _INTSIZEOF(v) )&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>define va_arg(ap,t) ( &lt;em>(t &lt;/em>)((ap += &lt;em>INTSIZEOF(t)) - &lt;/em>INTSIZEOF(t)) )&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>define va_end(ap) ( ap = (va_list)0 )&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>_INTSIZEOF(n)宏是为了考虑那些内存地址需要对齐的系统，从宏的名字来应该是跟sizeof(int)对齐。
一般的sizeof(int)=4，也就是参数在内存中的地址都为4的倍数。比如，如果sizeof(n)在1－4之间，
那_INTSIZEOF(n)＝4；如果sizeof(n)在5－8之间，那么_INTSIZEOF(n)=8。</p>




<p>为了能从固定参数依次得到每个可变参数，va_start,va_arg充分利用下面两点：</br>
&nbsp;&nbsp;&nbsp;&nbsp;1．C语言在函数调用时，先将最后一个参数压入栈;</br>
&nbsp;&nbsp;&nbsp;&nbsp;2．X86平台下的内存分配顺序是从高地址内存到低地址内存</br>
<center><img src="/images/2011/IMAG2011042101.png"></center></p>




<p>由上图可见，v是固定参数在内存中的地址，在调用va_start后，ap指向第一个可变参数。
这个宏的作用就是在v的内存地址上增加v所占的内存大小，这样就得到了第一个可变参数的地址。</p>




<p>接下来，可以这样设想，如果我能确定这个可变参数的类型，那么我就知道了它占用了多少内存，
依葫芦画瓢，我就能得到下一个可变参数的地址。</p>




<p>让我们再来看看va_arg，它先ap指向下一个可变参数，然后减去当前可变参数的大小即得到当前
可变参数的内存地址，再做个类型转换，返回它的值。</br>
要确定每个可变参数的类型，有两种做法，要么都是默认的类型，要么就在固定参数中包含足够的
信息让程序可以确定每个可变参数的类型。比如，printf，程序通过分析format字符串就可以
确定每个可变参数大类型。</br>
最后一个宏就简单了，va_end使得ap不再指向有效的内存地址。</p>




<p>看了这几个宏，不禁让我再次感慨，C语言太灵活了，而且代码可以写得非常简洁，
虽然有时候让人看得不是很明白，但是一旦明白 过来，你肯定会为它击掌叫好！</br>
其实在varargs.h头文件中定义了UNIX System V实行的va系列宏，而上面在stdarg.h头文件中
定义的是ANSI C形式的宏，这两种宏是不兼容的，一般说来，我们应该使用ANSI C形式的va宏。</p>




<h2>3.实战演练</h2>


<p>有没有办法写一个函数，这个函数参数的具体形式可以在运行时才确定？</br>
系统提供了vprintf系列格式化字符串的函数，用于编程人员封装自己的I/O函数。</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int vprintf / vscanf(const char * format, va_list ap); // 从标准输入/输出格式化字符串
</span><span class='line'>int vfprintf / vfsacanf(FILE * stream, const char * format, va_list ap);// 从文件流
</span><span class='line'>int vsprintf / vsscanf(char * s, const char * format, va_list ap); // 从字符串
</span><span class='line'>// 例1：格式化到一个文件流，可用于日志文件
</span><span class='line'>FILE *logfile;
</span><span class='line'>int WriteLog(const char * format, ...)
</span><span class='line'>{
</span><span class='line'>   va_list arg_ptr;
</span><span class='line'>   va_start(arg_ptr, format);
</span><span class='line'>   int nWrittenBytes = vfprintf(logfile, format, arg_ptr);
</span><span class='line'>   va_end(arg_ptr);
</span><span class='line'>   return nWrittenBytes;
</span><span class='line'>}
</span><span class='line'>...
</span><span class='line'>// 调用时，与使用printf()没有区别。
</span><span class='line'>WriteLog("%04d-%02d-%02d %02d:%02d:%02d %s/%04d logged out.", nYear, nMonth, nDay, nHour, nMinute, szUserName, nUserID);</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>同理，也可以从文件中执行格式化输入；或者对标准输入输出，字符串执行格式化。</br>
在上面的例1中，WriteLog()函数可以接受参数个数可变的输入，本质上，它的实现需要vprintf()的支持。
如何真正实现属于自己的可变参数函数，包括控制每一个传入的可选参数。</p>




<h2>4.关于va()函数和va宏</h2>


<p>C语言支持va函数，作为C语言的扩展--C++同样支持va函数，但在C++中并不推荐使用，C++引入的
多态性同样可以实现参数个数可变的函数。不过，C++的重载功能毕竟只能是有限多个可以预见的参数个数。
比较而言，C中的va函数则可以定义无穷多个相当于C++的重载函数，这方面C++是无能为力的。va函数的
优势表现在使用的方便性和易用性上，可以使代码更简洁。C编译器为了统一在不同的硬件架构、硬件
平台上的实现，和增加代码的可移植性，提供了一系列宏来屏蔽硬件环境不同带来的差异。</p>




<p>ANSI C标准下，va的宏定义在stdarg.h中，它们有：va_list，va_start()，va_arg()，va_end()。</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// 例2：求任意个自然数的平方和：
</span><span class='line'>int SqSum(int n1, ...)
</span><span class='line'>{
</span><span class='line'>   va_list arg_ptr;
</span><span class='line'>   int nSqSum = 0, n = n1;
</span><span class='line'>   va_start(arg_ptr, n1);
</span><span class='line'>   while (n > 0)
</span><span class='line'>  {
</span><span class='line'>nSqSum += (n * n);
</span><span class='line'>n = va_arg(arg_ptr, int);
</span><span class='line'>  }
</span><span class='line'>  va_end(arg_ptr);
</span><span class='line'>  return nSqSum;
</span><span class='line'>}
</span><span class='line'>// 调用时
</span><span class='line'>int nSqSum = SqSum(7, 2, 7, 11, -1);</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>可变参数函数的原型声明格式为：</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>type VAFunction(type arg1, type arg2, ... );</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>参数可以分为两部分：个数确定的固定参数和个数可变的可选参数。函数至少需要一个固定参数，
固定参数的声明和普通函数一样；可选参数由于个数不确定，声明时用"..."表示。固定参数和可选
参数公同构成一个函数的参数列表。借助上面这个简单的例2，来看看各个va_xxx的作用。</p>




<p>va_list arg_ptr：定义一个指向个数可变的参数列表指针；</br>
va_start(arg_ptr, argN)：使参数列表指针arg_ptr指向函数参数列表中的第一个可选参数，
说明：argN是位于第一个可选参数之前的固定参数，（或者说，最后一个固定参数；...
之前的一个参数），函数参数列表中参数在内存中的顺序与函数声明时的顺序是一致的。
如果有一va函数的声明是void va_test(char a, char b, char c, ...)，则它的固定
参数依次是a,b,c，最后一个固定参数argN为c，因此就是va_start(arg_ptr, c)。</br>
va_arg(arg_ptr, type)：返回参数列表中指针arg_ptr所指的参数，返回类型为type，
并使指针arg_ptr指向参数列表中下一个参数。</br>
va_copy(dest, src)：dest，src的类型都是va_list，va_copy()用于复制参数列表指针，将dest初始化为src。</br>
va_end(arg_ptr)：清空参数列表，并置参数指针arg_ptr无效。说明：指针arg_ptr被置无效后，
可以通过调用va_start()、va_copy()恢复arg_ptr。每次调用va_start() / va_copy()后，
必须得有相应的va_end()与之匹配。参数指针可以在参数列表中随意地来回移动，
但必须在va_start() ... va_end()之内。</p>



]]></content>
  </entry>
  
</feed>